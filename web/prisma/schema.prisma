generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model User {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String
  role      String   @default("admin")
  createdAt DateTime @default(now())
}

model ESP32Config {
  id            String   @id @default(cuid())
  wifiSSID      String
  wifiPassword  String
  mqttBroker    String   @default("broker.hivemq.com")
  mqttPort      Int      @default(1883)
  sensorPins    String   // JSON string: {"ph":34,"tds":35,"temp":32}
  pumpPins      String   // JSON string: {"circ":12,"phUp":13,"phDown":14,"nuteA":27,"nuteB":26}
  cameraUrl     String   @default("")
  updatedAt     DateTime @updatedAt
}

model SensorData {
  id          String   @id @default(cuid())
  timestamp   DateTime @default(now())
  ph          Float
  tds         Int
  waterTemp   Float
  airTemp     Float
  humidity    Float
  flowRate    Float
  waterLevel  String
  orp         Float    @default(350.0)
}

model GrowthCycle {
  id              String   @id @default(cuid())
  phase           String   // SEEDLING, VEGETATIVE, FLOWERING
  startDate       DateTime @default(now())
  harvestDate     DateTime?
  autopilotActive Boolean  @default(false)
  parameters      String   // JSON string with phase targets
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model HealthCheck {
  id          String   @id @default(cuid())
  timestamp   DateTime @default(now())
  imageUrl    String
  analysis    String
  healthScore Int
  actions     String   // JSON array of recommended actions
  severity    String   @default("normal") // normal, warning, critical
}

model SystemLog {
  id        String   @id @default(cuid())
  timestamp DateTime @default(now())
  level     String   // INFO, WARNING, CRITICAL, AI_DECISION
  message   String
  source    String   @default("system") // system, autopilot, ai, user
}

model AutopilotAction {
  id          String   @id @default(cuid())
  timestamp   DateTime @default(now())
  action      String   // pH_ADJUST, NUTRIENT_DOSE, etc.
  parameters  String   // JSON with action details
  success     Boolean  @default(true)
  cycleId     String?
}

model ActuatorStatus {
  id          String   @id @default(cuid())
  actuator    String   // "pump_main", "pump_ph_up", etc.
  state       Boolean  // ON/OFF
  lastChanged DateTime @default(now())
  duration    Int?     // For pumps (milliseconds)
  speed       Int?     // For fan (0-255)
}

model Notification {
  id        String   @id @default(cuid())
  type      String   // "critical", "warning", "info", "success"
  title     String
  message   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
}

model GrowthPhaseHistory {
  id        String   @id @default(cuid())
  phase     String   // From GrowthPhase enum
  startDate DateTime @default(now())
  endDate   DateTime?
  notes     String?
}

model Backup {
  id        String   @id @default(cuid())
  filename  String
  size      Int      // bytes
  createdAt DateTime @default(now())
}

model CalibrationLog {
  id        String   @id @default(cuid())
  sensor    String   // "ph", "tds"
  values    String   // JSON: {"ph4": 3.0, "ph7": 2.5}
  createdAt DateTime @default(now())
}
